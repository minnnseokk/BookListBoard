<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bookBoard.mapper.BookBoardMapper">
    <select id="selectBookBoardList" resultType="bookBoard.dto.BookBoardDto">
        SELECT 
            b.book_id AS bookId,
            b.title,
            b.author,
            b.publisher,
            b.published_date AS publishedDate,
            b.isbn,
            b.description,
            <!-- 조인으로 받아온 북 이미지 -->
            bi.image_url AS imageUrl
        <!-- 책정보에 대한 b와 북이미지에대한 bi로 조인함 -->
        FROM 
            Books b
        LEFT JOIN
        	BookImages bi ON b.book_id=bi.book_id
        ORDER BY 
            b.book_id DESC
    </select>
    <insert id="insertBook" parameterType="bookBoard.dto.BookBoardDto" useGeneratedKeys="true" keyProperty="bookId">
        INSERT INTO books (title, isbn, author, published_date, publisher, description, created_at, updated_at)
        VALUES (#{title}, #{isbn}, #{author}, #{publishedDate}, #{publisher}, #{description}, NOW(), NOW())
    </insert>
    <!-- 한개의 이미지를 저장하는 방식 -->
    <insert id="insertBookImage" parameterType="bookBoard.dto.BookBoardImgDto">
        insert into bookImages
            (book_id, image_url, created_at)
        values 
            (#{bookId}, #{imageUrl}, now())
    </insert>
</mapper>